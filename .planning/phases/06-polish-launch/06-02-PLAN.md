---
phase: 06-polish-launch
plan: 02
type: execute
---

<objective>
Add health check endpoint and document deployment setup.

Purpose: Enable basic monitoring and make deployment straightforward for anyone spinning up a new instance.
Output: /api/health endpoint, comprehensive DEPLOYMENT.md with env var reference and docker-compose workflow.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/06-polish-launch/06-CONTEXT.md

**Prior decisions affecting this phase:**
- Self-hosted deployment (not Vercel)
- Docker Compose for production
- Basic health check is sufficient (no advanced monitoring per CONTEXT.md)

**Relevant source files:**
@docker-compose.prod.yml - Production docker compose config
@Dockerfile - Multi-stage build with builder and runner stages
@.env.production.example - Production env template (incomplete)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Add health check API endpoint</name>
  <files>src/app/api/health/route.ts</files>
  <action>
    1. Create src/app/api/health/route.ts with GET handler
    2. Check database connectivity: simple prisma query (e.g., SELECT 1 or count users)
    3. Return JSON response:
       - status: "ok" or "error"
       - database: "connected" or "error"
       - timestamp: ISO date string
    4. Return 200 for healthy, 503 for unhealthy
    5. Add try/catch - if DB query fails, still return 503 with error info
    6. Keep it simple - no external service checks (Vapi, Stripe, etc.)
  </action>
  <verify>curl http://localhost:3000/api/health returns 200 with status "ok"</verify>
  <done>Health endpoint returns database connectivity status, 200 when healthy</done>
</task>

<task type="auto">
  <name>Task 2: Create deployment documentation</name>
  <files>DEPLOYMENT.md, .env.production.example</files>
  <action>
    1. Update .env.production.example with ALL required env vars:
       - Database: POSTGRES_USER, POSTGRES_PASSWORD, POSTGRES_DB
       - App: NEXT_PUBLIC_APP_URL, DOMAIN
       - Vapi: VAPI_API_KEY
       - Google: GOOGLE_CLIENT_ID, GOOGLE_CLIENT_SECRET, GOOGLE_ENCRYPTION_KEY
       - Stripe: STRIPE_SECRET_KEY, STRIPE_WEBHOOK_SECRET
       - SMTP: SMTP_HOST, SMTP_PORT, SMTP_USER, SMTP_PASS, SMTP_FROM
       - Add comments explaining each variable and how to obtain values

    2. Create DEPLOYMENT.md with sections:
       - Prerequisites (Docker, Docker Compose, domain with SSL)
       - Quick Start (clone, copy .env, fill values, docker compose up)
       - Environment Variables Reference (table with each var, required/optional, description)
       - Docker Compose Commands:
         - Start: docker compose -f docker-compose.prod.yml up -d
         - Migrate: docker compose -f docker-compose.prod.yml --profile migrate up migrate
         - Seed: docker compose -f docker-compose.prod.yml --profile seed up seed
         - Logs: docker compose -f docker-compose.prod.yml logs -f app
         - Stop: docker compose -f docker-compose.prod.yml down
       - Health Check (GET /api/health)
       - External Service Setup (brief notes on Vapi, Google Cloud, Stripe setup)
       - Troubleshooting (common issues and solutions)

    3. Keep docs concise and actionable - focus on getting running, not theory
  </action>
  <verify>DEPLOYMENT.md exists and covers all required env vars</verify>
  <done>Complete deployment documentation with env reference and docker commands</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] /api/health endpoint returns 200 with database status
- [ ] DEPLOYMENT.md covers all setup steps
- [ ] .env.production.example has all required variables with comments
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- Health endpoint works and checks DB connectivity
- Deployment docs are clear and complete
</success_criteria>

<output>
After completion, create `.planning/phases/06-polish-launch/06-02-SUMMARY.md`
</output>
