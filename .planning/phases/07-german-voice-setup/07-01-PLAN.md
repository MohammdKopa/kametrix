---
phase: 07-german-voice-setup
plan: 01
type: execute
---

<objective>
Configure Vapi assistants to use German voice (Azure TTS) and German speech recognition (Deepgram de).

Purpose: Transform Kametrix from English to German-only voice agents for the German market.
Output: All new and updated agents speak German and understand German callers.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
~/.claude/get-shit-done/references/checkpoints.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/07-german-voice-setup/07-RESEARCH.md
@.planning/phases/07-german-voice-setup/07-CONTEXT.md
@src/lib/vapi/assistants.ts

**Research findings (from 07-RESEARCH.md):**
- TTS: Switch from ElevenLabs `marissa` to Azure `de-DE-KatjaNeural`
- STT: Keep Deepgram Nova-2, change language from `en` to `de`
- Azure `de-DE-KatjaNeural` recommended by Vapi community for German phone calls
- No new packages needed - Vapi SDK handles provider switching

**Key constraint:**
- German is the ONLY language (no language selection UI needed)
- System prompts stay in English for Phase 7 (Phase 8 will localize)
</context>

<tasks>

<task type="auto">
  <name>Task 1: Update Vapi assistant configuration for German voice and transcription</name>
  <files>src/lib/vapi/assistants.ts</files>
  <action>
Update the voice and transcriber configuration in assistants.ts:

1. In `createBusinessAssistant()` (around line 140-148):
   - Change voice provider from `'11labs'` to `'azure'`
   - Change voiceId default from `'marissa'` to `'de-DE-KatjaNeural'`
   - Change transcriber language from `'en'` to `'de'`

2. In `updateAssistant()` (around line 189-194):
   - Change voice provider from `'11labs'` to `'azure'`

3. Update `endCallMessage` (line 150) to German:
   - Change from `'Thank you for calling. Have a great day!'`
   - To `'Vielen Dank für Ihren Anruf. Auf Wiederhören!'`

**Do NOT change:**
- System prompt language (stays English, Phase 8 will localize)
- Greeting message (stays English, Phase 8 will localize)
- Any other configuration

**Pitfall to avoid:** Don't forget to update BOTH createBusinessAssistant AND updateAssistant - if only one is updated, agents created vs updated will have mismatched configurations.
  </action>
  <verify>npm run build succeeds without TypeScript errors</verify>
  <done>Voice config uses Azure de-DE-KatjaNeural, transcriber uses language 'de', both create and update functions aligned</done>
</task>

<task type="checkpoint:human-verify" gate="blocking">
  <what-built>German voice configuration for Vapi assistants - agents now use Azure German TTS and Deepgram German STT</what-built>
  <how-to-verify>
    1. Start dev server: npm run dev
    2. Create a new agent in the dashboard (or use existing test agent)
    3. Make a test call to the agent's phone number
    4. Speak in German to the agent (e.g., "Guten Tag, ich möchte einen Termin buchen")
    5. Confirm:
       - Agent responds with a German-sounding voice (de-DE-KatjaNeural)
       - Agent understands your German speech
       - Conversation flows naturally in German context

    Note: The greeting and system prompts are still in English (Phase 8 will localize).
    The key verification is that the VOICE sounds German and the agent UNDERSTANDS German speech.
  </how-to-verify>
  <resume-signal>Type "approved" if German voice and comprehension work correctly, or describe any issues</resume-signal>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm run lint` passes (if configured)
- [ ] Voice configuration in createBusinessAssistant uses Azure provider
- [ ] Voice configuration in updateAssistant uses Azure provider
- [ ] Transcriber language is set to 'de' in createBusinessAssistant
- [ ] Test call confirms German voice output
- [ ] Test call confirms German speech comprehension
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- New agents created speak with German voice (Azure de-DE-KatjaNeural)
- Agent understands German speech input (Deepgram de)
- No TypeScript or build errors introduced
</success_criteria>

<output>
After completion, create `.planning/phases/07-german-voice-setup/07-01-SUMMARY.md`:

# Phase 7 Plan 1: German Voice Configuration Summary

**[One-liner summary of what was accomplished]**

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- `src/lib/vapi/assistants.ts` - Updated voice/transcriber configuration

## Decisions Made
- [Any decisions made during implementation]

## Issues Encountered
- [Problems and resolutions, or "None"]

## Next Step
Phase 7 complete, ready for Phase 8 (German Prompts & Localization)
</output>
