---
phase: 02-core-dashboard
plan: 02
type: execute
---

<objective>
Build agent management UI - list, create, edit, and delete agents.

Purpose: This is the core workflow for users. They need to create agents, configure them, and manage their status. Agent data saves to database only - Vapi integration comes in Phase 3.
Output: Working agent list page with status cards, create/edit forms, delete functionality, and supporting API routes.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/02-core-dashboard/02-CONTEXT.md
@.planning/phases/02-core-dashboard/02-01-SUMMARY.md

**Prior decisions:**
- Tab navigation established in 02-01
- Clean/minimal aesthetic (Linear/Stripe style)
- Agent cards show: name, phone number, active/inactive status, toggle button

**Database schema (Agent model):**
- id, userId, name, vapiAssistantId (null for now), greeting, systemPrompt, voiceId
- businessName, businessDescription, isActive, createdAt, updatedAt
- Relations: user, calls, phoneNumber

**Boundaries:**
- Vapi integration out of scope - just save to database
- No phone number assignment yet (Phase 3)

@src/lib/prisma.ts
@src/lib/auth-guard.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create agent list page with status cards</name>
  <files>src/app/(dashboard)/dashboard/agents/page.tsx, src/components/dashboard/agent-card.tsx, src/app/api/agents/route.ts</files>
  <action>
    Create the agents list view:

    1. Create src/app/api/agents/route.ts:
       - GET: List all agents for authenticated user
       - Include phone number relation in query
       - Return agents sorted by createdAt desc
       - Use requireAuth pattern from auth-guard

    2. Create src/components/dashboard/agent-card.tsx:
       - Card component showing agent info
       - Display: name, phone number (or "No phone assigned"), active/inactive badge
       - Toggle switch for isActive status (calls PATCH endpoint)
       - Edit button (links to edit page)
       - Delete button (with confirmation)
       - Clean card styling matching dashboard aesthetic

    3. Create src/app/(dashboard)/dashboard/agents/page.tsx:
       - Server component that fetches agents via API or direct Prisma
       - Grid of agent cards
       - "Create Agent" button (top right, links to /dashboard/agents/new)
       - Empty state if no agents: "No agents yet. Create your first agent."

    For the toggle, use a client component wrapper or make the card a client component that handles the PATCH call.
  </action>
  <verify>npm run build succeeds, /dashboard/agents shows agent list (empty state if none)</verify>
  <done>Agent list page renders with cards showing name, status, and action buttons</done>
</task>

<task type="auto">
  <name>Task 2: Create agent forms and API routes</name>
  <files>src/app/(dashboard)/dashboard/agents/new/page.tsx, src/app/(dashboard)/dashboard/agents/[id]/edit/page.tsx, src/components/dashboard/agent-form.tsx, src/app/api/agents/route.ts, src/app/api/agents/[id]/route.ts</files>
  <action>
    Create agent CRUD operations:

    1. Update src/app/api/agents/route.ts to add POST:
       - Validate required fields: name, greeting, systemPrompt, voiceId, businessName
       - Create agent with userId from auth
       - Return created agent

    2. Create src/app/api/agents/[id]/route.ts:
       - GET: Get single agent (verify ownership)
       - PATCH: Update agent fields (verify ownership)
       - DELETE: Delete agent (verify ownership)
       - All routes use requireAuth and verify user owns the agent

    3. Create src/components/dashboard/agent-form.tsx:
       - Reusable form for create/edit
       - Fields: name, businessName, businessDescription (optional), greeting, systemPrompt (textarea), voiceId (dropdown with placeholder options)
       - Submit button with loading state
       - Client component with form handling
       - Voice options for now: "alloy", "echo", "fable", "onyx", "nova", "shimmer" (placeholder until Vapi integration)

    4. Create src/app/(dashboard)/dashboard/agents/new/page.tsx:
       - Page wrapper for create form
       - On success, redirect to /dashboard/agents

    5. Create src/app/(dashboard)/dashboard/agents/[id]/edit/page.tsx:
       - Fetch existing agent data
       - Pre-fill form
       - On success, redirect to /dashboard/agents

    Form validation: Required fields must be filled. Name max 100 chars. Greeting max 500 chars.
  </action>
  <verify>npm run build succeeds, can navigate to /dashboard/agents/new and see form</verify>
  <done>Create and edit forms work, agents persist to database</done>
</task>

<task type="auto">
  <name>Task 3: Add toggle and delete functionality</name>
  <files>src/components/dashboard/agent-card.tsx, src/components/ui/toggle.tsx, src/components/ui/confirm-dialog.tsx</files>
  <action>
    Complete the agent card interactions:

    1. Create src/components/ui/toggle.tsx:
       - Simple toggle/switch component
       - Props: checked, onChange, disabled, label (optional)
       - Styled with Tailwind (no external library needed)

    2. Create src/components/ui/confirm-dialog.tsx:
       - Simple confirmation modal
       - Props: isOpen, onConfirm, onCancel, title, message
       - Styled modal with backdrop
       - No external library - use native dialog or portal

    3. Update src/components/dashboard/agent-card.tsx:
       - Wire up toggle to call PATCH /api/agents/[id] with isActive update
       - Wire up delete button to show confirm dialog
       - On confirm, call DELETE /api/agents/[id]
       - Show loading states during API calls
       - Refresh list after toggle/delete (use router.refresh or revalidation)

    Keep it simple - basic toggle and modal, no fancy animations needed.
  </action>
  <verify>npm run build succeeds, toggle and delete buttons functional</verify>
  <done>Agent toggle updates status, delete removes agent with confirmation</done>
</task>

</tasks>

<verification>
Before declaring plan complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npx tsc --noEmit` passes
- [ ] GET /api/agents returns user's agents
- [ ] POST /api/agents creates new agent
- [ ] PATCH /api/agents/[id] updates agent
- [ ] DELETE /api/agents/[id] removes agent
- [ ] Agent list page shows cards with status
- [ ] Create form works and saves to database
- [ ] Edit form loads existing data and updates
- [ ] Toggle updates isActive status
- [ ] Delete shows confirmation and removes agent
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Full CRUD operations for agents working
- UI matches clean/minimal aesthetic
</success_criteria>

<output>
After completion, create `.planning/phases/02-core-dashboard/02-02-SUMMARY.md`:

# Phase 02-02: Agent Management UI Summary

**[Substantive one-liner]**

## Accomplishments
- [Key outcomes]

## Files Created/Modified
- [File list with descriptions]

## Decisions Made
[Key decisions and rationale, or "None"]

## Issues Encountered
[Problems and resolutions, or "None"]

## Next Step
Ready for 02-03-PLAN.md (Calls & Credits Views)
</output>
