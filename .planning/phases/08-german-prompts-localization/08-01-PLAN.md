---
phase: 08-german-prompts-localization
plan: 1
type: execute
---

<objective>
Localize all agent-facing text to native German with formal Sie-form and proper spoken date/time formatting.

Purpose: Make the AI voice agent sound like a competent German business receptionist, not translated English.
Output: German localization helpers, native German system prompts, localized webhook responses.
</objective>

<execution_context>
~/.claude/get-shit-done/workflows/execute-phase.md
~/.claude/get-shit-done/templates/summary.md
</execution_context>

<context>
@.planning/PROJECT.md
@.planning/ROADMAP.md
@.planning/STATE.md
@.planning/phases/08-german-prompts-localization/08-CONTEXT.md
@.planning/phases/08-german-prompts-localization/08-RESEARCH.md

**Prior decisions affecting this phase:**
- Phase 7: Azure de-DE-KatjaNeural TTS and Deepgram German STT already configured
- Voice/transcriber settings already German, this phase focuses on prompts and responses

**Key constraints from CONTEXT.md:**
- Dashboard stays English - only agent-facing text is German
- All agents use formal Sie-form (no Du option)
- 24-hour time format spoken naturally ("vierzehn Uhr dreißig")
- Write prompts in German from scratch, not translations

**Key patterns from RESEARCH.md:**
- Use Intl.DateTimeFormat for written date formatting
- Create custom spoken time conversion (no library for this)
- German business greeting pattern: "[Business], guten Tag! Wie kann ich Ihnen behilflich sein?"

**Relevant source files:**
@src/lib/vapi/assistants.ts
@src/app/api/webhooks/vapi/route.ts
</context>

<tasks>

<task type="auto">
  <name>Task 1: Create German localization helpers</name>
  <files>src/lib/localization/spoken-format.ts, src/lib/localization/index.ts</files>
  <action>
Create new localization module with:

1. `numberToGerman(n: number): string` - Convert 0-59 to spoken German words
   - Direct mappings for 0-20 (null, eins, zwei... zwanzig)
   - Compound numbers: 21 = "einundzwanzig" (one-and-twenty pattern)
   - Cover 0-59 for hours/minutes

2. `timeToSpokenGerman(time: string): string` - Convert "14:30" to "vierzehn Uhr dreißig"
   - Parse HH:MM format
   - For :00 minutes, just say "neun Uhr"
   - For other minutes, say "vierzehn Uhr dreißig"

3. `formatDateGerman(date: Date): string` - Use Intl.DateTimeFormat for written format
   - Return "15. Januar 2025" style

4. `formatDateSpokenGerman(date: Date): string` - Full spoken format
   - Return "Mittwoch, der 15. Januar" (weekday + ordinal + month)

Export all functions from index.ts.

Note: Use Intl.DateTimeFormat where possible (don't hand-roll date formatting). Only custom code for spoken number/time conversion.
  </action>
  <verify>
Create test file src/lib/localization/__tests__/spoken-format.test.ts with cases:
- numberToGerman(14) === 'vierzehn'
- numberToGerman(21) === 'einundzwanzig'
- timeToSpokenGerman('14:30') === 'vierzehn Uhr dreißig'
- timeToSpokenGerman('09:00') === 'neun Uhr'
Run: npm test -- spoken-format
  </verify>
  <done>All localization helpers work correctly with unit tests passing</done>
</task>

<task type="auto">
  <name>Task 2: Rewrite system prompts in native German</name>
  <files>src/lib/vapi/assistants.ts</files>
  <action>
Rewrite `buildSystemPrompt` function to generate native German prompts:

Replace the English system prompt with German, following these patterns from RESEARCH.md:

```
Sie sind der KI-Assistent für ${businessName}.

## Geschäftsinformationen
- Firmenname: ${businessName}
- Öffnungszeiten: ${businessHours}
- Dienstleistungen: ${services.join(', ')}

[If FAQs exist:]
## Häufige Fragen
F: ${question}
A: ${answer}

[If calendar tools:]
## Kalender-Funktionen
- Sie können die Verfügbarkeit mit dem check_availability-Tool prüfen
- Sie können Termine mit dem book_appointment-Tool buchen
- Erfragen Sie bei Terminbuchungen: Datum, Uhrzeit, Name des Anrufers (erforderlich), Telefonnummer (optional), E-Mail (optional)
- Bestätigen Sie immer die Details vor der Buchung
- Verwenden Sie das aktuelle Datum am Anfang dieses Prompts für Datumsberechnungen

## Richtlinien
- Sprechen Sie Anrufer mit "Sie" an (formell)
- Seien Sie freundlich, professionell und präzise
- Beantworten Sie Fragen zum Unternehmen anhand der obigen Informationen
- Wenn Sie etwas nicht wissen, sagen Sie höflich, dass sich jemand bei ihnen melden wird
- Halten Sie Antworten kurz und natürlich für Telefongespräche
[If calendar:] - Nutzen Sie bei Terminanfragen Ihre Kalender-Tools
[If no calendar:] - Bei Terminwünschen: Name, bevorzugtes Datum/Uhrzeit und Grund erfragen
```

Also update the default greeting in `createBusinessAssistant`:
- Old: `Hello! Thank you for calling ${config.businessName}. How can I help you today?`
- New: `${config.businessName}, guten Tag! Wie kann ich Ihnen behilflich sein?`

The `endCallMessage` is already German: 'Vielen Dank für Ihren Anruf. Auf Wiederhören!'

IMPORTANT: Do NOT translate word-for-word. Use native German business phrasing as shown above.
  </action>
  <verify>
- npm run build succeeds
- Read the updated buildSystemPrompt and confirm Sie-form throughout
- Confirm no English phrases remain in system prompt generation
  </verify>
  <done>System prompts are native German with formal Sie-form, no English phrases</done>
</task>

<task type="auto">
  <name>Task 3: Localize webhook tool responses</name>
  <files>src/app/api/webhooks/vapi/route.ts</files>
  <action>
Localize all English response strings in the webhook handler to German.

Find and replace these hardcoded English responses in `handleToolCalls`:

**check_availability responses:**
- `I don't see any available slots on ${date}. Would you like to try a different day?`
  → `Am ${date} sind leider keine Termine mehr frei. Möchten Sie einen anderen Tag versuchen?`

- `I have the following times available on ${date}: ${slotList}. Which time works best for you?`
  → `Am ${date} habe ich folgende Zeiten verfügbar: ${slotList}. Welche Zeit passt Ihnen am besten?`

**book_appointment responses:**
- `I've booked your appointment for ${date} at ${time}. You're all set, ${name}!`
  → `Ihr Termin am ${date} um ${time} ist eingetragen. Vielen Dank, ${name}!`

- `I wasn't able to book that appointment. The time slot might be taken. Would you like to try a different time?`
  → `Den Termin konnte ich leider nicht eintragen. Dieser Zeitpunkt ist möglicherweise bereits belegt. Möchten Sie eine andere Zeit versuchen?`

**Error responses:**
- `I'm sorry, I'm having technical difficulties right now.`
  → `Es tut mir leid, ich habe momentan technische Schwierigkeiten.`

- `I'm sorry, I encountered an error. Could you please try that again?`
  → `Es tut mir leid, es ist ein Fehler aufgetreten. Könnten Sie das bitte noch einmal versuchen?`

- `I'm sorry, calendar booking isn't set up yet. Please call back later or leave your contact information.`
  → `Leider ist die Kalenderbuchung noch nicht eingerichtet. Bitte rufen Sie später noch einmal an oder hinterlassen Sie Ihre Kontaktdaten.`

- `I'm having trouble checking the calendar right now. Please try again.`
  → `Ich habe gerade Schwierigkeiten, den Kalender zu prüfen. Bitte versuchen Sie es noch einmal.`

Also update the date display in responses to use German format. Import and use `formatDateGerman` from the localization module for date strings in responses.

Note: Keep log messages in English (those are for developers, not callers).
  </action>
  <verify>
- npm run build succeeds
- Grep for English phrases in tool response strings - should find none
- Confirm all user-facing strings are German
  </verify>
  <done>All webhook tool responses are in German, no English user-facing text remains</done>
</task>

</tasks>

<verification>
Before declaring phase complete:
- [ ] `npm run build` succeeds without errors
- [ ] `npm test` passes (including new localization tests)
- [ ] Grep src/lib/vapi/assistants.ts for English - only comments should have English
- [ ] Grep webhook route.ts for common English phrases ("I'm sorry", "Would you like") - none in response strings
- [ ] All German text uses Sie-form consistently (no "du", "dein", "dir")
</verification>

<success_criteria>
- All tasks completed
- All verification checks pass
- No TypeScript errors
- Localization helpers tested and working
- System prompts are native German (not translated)
- Webhook responses are all German
- Sie-form used consistently throughout
</success_criteria>

<output>
After completion, create `.planning/phases/08-german-prompts-localization/08-01-SUMMARY.md`:

# Phase 8 Plan 1: German Prompts & Localization Summary

**[One-liner summary of what shipped]**

## Accomplishments
- Created German localization helpers (spoken time/number formatting)
- Rewrote system prompts in native German with Sie-form
- Localized all webhook tool responses to German

## Files Created/Modified
- `src/lib/localization/spoken-format.ts` - New: German number/time formatting
- `src/lib/localization/index.ts` - New: Module exports
- `src/lib/localization/__tests__/spoken-format.test.ts` - New: Unit tests
- `src/lib/vapi/assistants.ts` - Modified: German system prompts
- `src/app/api/webhooks/vapi/route.ts` - Modified: German tool responses

## Decisions Made
[Key decisions and rationale, or "None"]

## Issues Encountered
[Problems and resolutions, or "None"]

## Next Step
Phase 8 complete, ready for Phase 9 (Dashboard UI Polish)
</output>
